<div class="character_sheet">
  <div class="pools">
    <h2 data-i18n="dice_pool">Dice Pool</h2>
    <div class="dice_pool section">      
      <div class="dice_pool_grid">
        <div class="positive_dice">
          <div class="three_dice">
            <div>
              <img src="https://i.imgur.com/nlIAfJx.png" data-i18n-title="boost_die" title="Boost Die" />
              <input name="attr_b" class="dice_pool_boost" type="number" min="0" max="7" value="0" />
            </div>
            <div>
              <img src="https://i.imgur.com/g3hoJRG.png" data-i18n-title="ability_die" title="Ability Die" />
              <input name="attr_g" class="dice_pool_ability" type="number" min="0" max="7" value="0" />
            </div>
            <div>
              <img src="https://i.imgur.com/4bQ0dY8.png" data-i18n-title="proficiency_die" title="Proficiency Die" />
              <input name="attr_y" class="dice_pool_proficiency" type="number" min="0" max="7" value="0" />
            </div>
          </div>
          <div class="upgrade_downgrade">
            <label class="upgrade_label" data-i18n="upgrade">Upgrade :</label>
            <input name="attr_upgradeAbility" class="dice_pool_upgrade_positive" type="number" min="0" max="7" value="0" />
            <input name="attr_downgradeProficiency" class="dice_pool_downgrade_positive" type="number" min="0" max="7" value="0" />
            <label class="downgrade_label" data-i18n="downgrade">: Downgrade</label>
          </div>
        </div>
        <div class="force_dice_dice_roll">
          <div class="force_dice">
            <img src="https://i.imgur.com/JCI7Mgm.png" data-i18n-title="force_die" title="Force Die" />
            <input name="attr_w" class="dice_pool_force" type="number" min="0" max="7" value="0" />
          </div>
          <div class="dice_roll">
            <input type="hidden" name="attr_dicePool" value="@{g}g @{y}y @{p}p @{r}r @{b}b @{blk}blk @{w}w upgrade(ability|@{upgradeAbility}) downgrade(proficiency|@{downgradeProficiency}) upgrade(difficulty|@{upgradeDifficulty}) downgrade(challenge|@{downgradeChallenge})" />
            <button type="roll" name="roll_DicePool" class="roll_DicePool" data-i18n-title="roll_dice_pool" title="Roll dice pool" value="!eed characterID(@{character_id}) label(Dice:Dice Pool) @{dicePool}"></button>
            <button type="roll" name="roll_ResetDicePool" class="roll_ResetDicePool" data-i18n-title="reset_dice_pool" title="Reset dice pool" value="!eed resetdice characterID(@{character_id})"></button>
          </div>
        </div>
        <div class="negative_dice">
          <div class="three_dice">
            <div>
              <img src="https://i.imgur.com/n9W07Lp.png" data-i18n-title="setback_die" title="Setback Die" />
              <input name="attr_blk" class="dice_pool_setback" type="number" min="-7" max="7" value="0" />
            </div>
            <div>
              <img src="https://i.imgur.com/oxbKghK.png" data-i18n-title="difficulty_die" title="Difficulty Die" />
              <input name="attr_p" class="dice_pool_difficulty" type="number" min="0" max="7" value="0" />
            </div>
            <div>
              <img src="https://i.imgur.com/GInMHEN.png" data-i18n-title="challenge_die" title="Challenge Die" />
              <input name="attr_r" class="dice_pool_challenge" type="number" min="0" max="7" value="0" />
            </div>
          </div>
          <div class="upgrade_downgrade">
            <label class="upgrade_label" data-i18n="upgrade">Upgrade :</label>
            <input name="attr_upgradeDifficulty" class="dice_pool_upgrade_negative" type="number" min="0" max="7" value="0" />
            <input name="attr_downgradeChallenge" class="dice_pool_downgrade_negative" type="number" min="0" max="7" value="0" />
            <label class="downgrade_label" data-i18n="downgrade">: Downgrade</label>
          </div>
        </div>
      </div>
    </div>
    <h2>Destiny Pool</h2>
    <div class="destiny_pool section">
      <div class="destiny_buttons">
        <button class="sync_destiny_pool_button" name="Update-Dest-Pool" value="!eed characterID(@{character_id}) destiny registerPlayer" data-i18n="sync_pool_gm">Sync Pool with GM</button>
        <button class="roll_destiny_button" name="Roll-Destiny" value="!eed characterID(@{character_id}) 1w destiny doRoll" data-i18n="roll_destiny">Roll Destiny</button>
      </div>
      <div class="destiny_inputs">
        <div>
          <input type="number" class="attr_destiny_light" min="0" max="99" value="0" />
          <label class="destiny_light_label" name='attr_light' value="@{lightSidePoints}" data-i18n="light">Light</label>
        </div>
        <div>
          <button class="use_destiny_button" name="Use-Darkside-Point" value="!eed characterID(@{character_id}) destiny useLight" data-i18n="use_light_side_point">Use Light Side Point</button>
        </div>
        <div>
          <input type="number" class="attr_destiny_dark" min="0" max="99" value="0" />
          <label class="destiny_dark_label" name='attr_dark' value="@{darkSidePoints}" data-i18n="dark">Dark</label>
        </div>
      </div>
    </div>
  </div>
  <h2>Vital Stats</h2>
  <div class="vital_stats section"> 
    <div class="soak">
      <label data-i18n="soak" class="stat_label">Soak</label>
      <div class="vital_stats_column">
        <div class="cell_width_2">
          <input name="attr_body_stats_soak" class="soak" type="number" maxlength="1" min="1" max="9" value="0" />
        </div>
      </div>
    </div>
    <div class="defense">
      <label data-i18n="defense" class="stat_label">Defense</label>
      <div class="vital_stats_column">
        <div>            
          <input name="attr_body_stats_defense_ranged" type="number" maxlength="1" min="0" max="9" value="0" />
          <label data-i18n="ranged" class="threshold_label">Ranged</label>
        </div>
        <div>            
          <input name="attr_body_stats_defense_melee" type="number" maxlength="1" min="0" max="9" value=0" />
          <label data-i18n="melee" class="current_label">Melee</label>
        </div>
      </div>
    </div>
    <div class="wounds">
      <label data-i18n="wounds" class="stat_label">Wounds</label>
      <div class="vital_stats_column">
        <div>            
          <input name="attr_body_stats_wounds_threshold" class="wounds_threshold" type="number" maxlength="2" min="1" max="99" value="0" />
          <label data-i18n="threshold" class="threshold_label">Threshold</label>
        </div>
        <div>            
          <input name="attr_body_stats_wounds_current" class="wounds_current" type="number" maxlength="2" min="0" max="99" value="0" />
          <label data-i18n="current" class="current_label">Current</label>
        </div>
      </div>        
    </div>
    <div class="strain">
      <label data-i18n="strain" class="stat_label">Strain</label>
      <div class="vital_stats_column">
        <div>            
          <input name="attr_body_stats_strain_threshold" class="strain_threshold" type="number" maxlength="2" min="1" max="99" value="0" />
          <label data-i18n="threshold" class="threshold_label">Threshold</label>
        </div>
        <div>            
          <input name="attr_body_stats_strain_current" class="strain_current" type="number" maxlength="2" min="0" max="99" value="0" />
          <label data-i18n="current" class="current_label">Current</label>
        </div>
      </div>        
    </div>
  </div>
  <div class="tab_navigation">
    <div>
      <input type="radio" name="attr_navSelection" value="skills" class="navSelection_radio" />
      <button type="action" name="act_skills"><span data-i18n="skills">Skills</span></button>
    </div>
    <div>
      <input type="radio" name="attr_navSelection" value="combat" class="navSelection_radio" />
      <button type="action" name="act_combat"><span data-i18n="combat">Combat</span></button>
    </div>
    <div>
      <input type="radio" name="attr_navSelection" value="equipment" class="navSelection_radio" />
      <button type="action" name="act_equipment"><span data-i18n="equipment">Equipment</span></button>
    </div>
    <div>
      <input type="radio" name="attr_navSelection" value="talents" class="navSelection_radio" />
      <button type="action" name="act_talents"><span data-i18n="talents">Talents</span></button>
    </div>
    <div>
      <input type="radio" name="attr_navSelection" value="force" class="navSelection_radio" />
      <button type="action" name="act_force"><span data-i18n="the_force">The Force</span></button>
    </div>
    <div>
      <input type="radio" name="attr_navSelection" value="settings" class="navSelection_radio" />
      <button type="action" name="act_settings"><span data-i18n="settings">Settings</span></button>
    </div>
  </div>
  <input type='hidden' class='sheet-tabstoggle' name='attr_sheetTab'  value='skills' />
  <div class="sheet-skills">
    <h2 data-i18n="characteristics">Characteristics</h2>
    <div class="characteristics section">
      <div>
        <input name="attr_brawn" class="characteristics_brawn" type="number" min="1" max="7" value="1" />
        <label data-i18n="brawn">Brawn</label>
      </div>
      <div>
        <input name="attr_agility" class="characteristics_agility" type="number" min="1" max="7" value="1" />
        <label data-i18n="agility">Agility</label>
      </div>
      <div>
        <input name="attr_intellect" class="characteristics_intellect" type="number" min="1" max="7" value="1" />
        <label data-i18n="intellect">Intellect</label>
      </div>
      <div>
        <input name="attr_cunning" class="characteristics_cunning" type="number" min="1" max="7" value="1" />
        <label data-i18n="cunning">Cunning</label>
      </div>
      <div>
        <input name="attr_willpower" class="characteristics_willpower" type="number" min="1" max="7" value="1" />
        <label data-i18n="willpower">Willpower</label>
      </div>
      <div>
        <input name="attr_presence" class="characteristics_presence" type="number" min="1" max="7" value="1" />
        <label data-i18n="presence">Presence</label>
      </div>
    </div>
    <h2>Skills</h2>
    <div class="skills_body section">
      <div class="skills_general">     
        <h3>General Skills</h3>
        <div class="skill skill_heading">          
          <div data-i18n="skill">Skill</div>
          <div data-i18n="characteristic">Characteristic</div>
          <div data-i18n="career">Career</div>
          <div data-i18n="ranks">Ranks</div>
          <div data-i18n="dice">Dice</div>
          <div data-i18n="modifiers">Modifiers</div>
          <div data-i18n="roll">Roll</div>
        </div>       
        <div class="skill">          
          <label data-i18n="astrogation">Astrogation</label>
          <div>(<span data-i18n="intellect_abbr">Int</span>)</div>
          <input type="checkbox" name="attr_astrogation_career" value="true" />
          <input type="number"  name="attr_astrogation_rank" min="0" max="6" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_astrogation_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_astrogation_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_astrogation_modifiers" />
          <button class="roll_button" type="roll" name="roll_astrogation" value="!eed characterID(@{character_id}) label(skill:Astrogation) @{astrogation_modifiers} skill(@{astrogation_rank}|@{intellect}|Astrogation) @{dicePool}"></button>
        </div>
        <div class="skill">          
          <label data-i18n="athletics">Athletics</label>
          <div>(<span data-i18n="brawn_abbr">Bra</span>)</div>
          <input type="checkbox" name="attr_athletics_career" value="true" />
          <input type="number"  name="attr_athletics_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_athletics_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_athletics_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_athletics_modifiers" />
          <button class="roll_button" type="roll" name="roll_athletics" value="!eed characterID(@{character_id}) label(skill:Athletics) @{athletics_modifiers} skill(@{athletics_rank}|@{brawn}|Athletics) @{dicePool}"></button>
        </div>
        <div class="skill">          
          <label data-i18n="charm">Charm</label>
          <div>(<span data-i18n="presence_abbr">Pr</span>)</div>
          <input type="checkbox" name="attr_charm_career" value="true" />
          <input type="number"  name="attr_charm_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_charm_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_charm_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_charm_modifiers" />
          <button class="roll_button" type="roll" name="roll_charm" value="!eed characterID(@{character_id}) label(skill:Charm) @{charm_modifiers} skill(@{charm_rank}|@{presence}|Charm) @{dicePool}"></button>
        </div>
        <div class="skill">          
          <label data-i18n="coercion">Coercion</label>
          <div>(<span data-i18n="willpower_abbr">Wil</span>)</div>
          <input type="checkbox" name="attr_coercion_career" value="true" />
          <input type="number"  name="attr_coercion_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_coercion_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_coercion_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_coercion_modifiers" />
          <button class="roll_button" type="roll" name="roll_coercion" value="!eed characterID(@{character_id}) label(skill:Coercion) @{coercion_modifiers} skill(@{coercion_rank}|@{willpower}|Coercion) @{dicePool}"></button>
        </div>
        <div class="skill">          
          <label data-i18n="computers">Computers</label>
          <div>(<span data-i18n="intellect_abbr">Int</span>)</div>
          <input type="checkbox" name="attr_computers_career" value="true" />
          <input type="number"  name="attr_computers_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="ydcool" type="hidden" name="attr_computers_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_computers_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_computers_modifiers" />
          <button class="roll_button" type="roll" name="roll_computers" value="!eed characterID(@{character_id}) label(skill:Computers) @{computers_modifiers} skill(@{computers_rank}|@{intellect}|Computers) @{dicePool}"></button>
        </div>
        <div class="skill">          
          <label data-i18n="cool">Cool</label>
          <div>(<span data-i18n="presence_abbr">Pr</span>)</div>
          <input type="checkbox" name="attr_cool_career" value="true" />
          <input type="number"  name="attr_cool_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_cool_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_cool_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_cool_modifiers" />
          <button class="roll_button" type="roll" name="roll_cool" value="!eed characterID(@{character_id}) label(skill:Cool) @{cool_modifiers} skill(@{cool_rank}|@{presence}|Cool) @{dicePool}"></button>
        </div>
        <div class="skill">          
          <label data-i18n="coordination">Coordination</label>
          <div>(<span data-i18n="agility_abbr">Ag</span>)</div>
          <input type="checkbox" name="attr_coordination_career" value="true" />
          <input type="number"  name="attr_coordination_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_coordination_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_coordination_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_coordination_modifiers" />
          <button class="roll_button" type="roll" name="roll_coordination" value="!eed characterID(@{character_id}) label(skill:Coordination) @{coordination_modifiers} skill(@{coordination_rank}|@{agility}|Coordination) @{dicePool}"></button>
        </div>
        <div class="skill">          
          <label data-i18n="deception">Deception</label>
          <div>(<span data-i18n="cunning_abbr">Cun</span>)</div>
          <input type="checkbox" name="attr_deception_career" value="true" />
          <input type="number"  name="attr_deception_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_deception_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_deception_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_deception_modifiers" />
          <button class="roll_button" type="roll" name="roll_deception" value="!eed characterID(@{character_id}) label(skill:Deception) @{deception_modifiers} skill(@{deception_rank}|@{cunning}|Deception) @{dicePool}"></button>
        </div>
        <div class="skill">          
          <label data-i18n="discipline">Discipline</label>
          <div>(<span data-i18n="willpower_abbr">Wil</span>)</div>
          <input type="checkbox" name="attr_discipline_career" value="true" />
          <input type="number"  name="attr_discipline_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_discipline_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_discipline_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_discipline_modifiers" />
          <button class="roll_button" type="roll" name="roll_discipline" value="!eed characterID(@{character_id}) label(skill:Discipline) @{discipline_modifiers} skill(@{discipline_rank}|@{willpower}|Discipline) @{dicePool}"></button>
        </div>
        <div class="skill">          
          <label data-i18n="leadership">Leadership</label>
          <div>(<span data-i18n="presence_abbr">Pr</span>)</div>
          <input type="checkbox" name="attr_leadership_career" value="true" />
          <input type="number"  name="attr_leadership_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_leadership_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_leadership_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_leadership_modifiers" />
          <button class="roll_button" type="roll" name="roll_leadership" value="!eed characterID(@{character_id}) label(skill:Leadership) @{leadership_modifiers} skill(@{leadership_rank}|@{presence}|Leadership) @{dicePool}"></button>
        </div>
        <div class="skill">          
          <label data-i18n="mechanics">Mechanics</label>
          <div>(<span data-i18n="intellect_abbr">Int</span>)</div>
          <input type="checkbox" name="attr_mechanics_career" value="true" />
          <input type="number"  name="attr_mechanics_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_mechanics_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_mechanics_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_mechanics_modifiers" />
          <button class="roll_button" type="roll" name="roll_mechanics" value="!eed characterID(@{character_id}) label(skill:Mechanics) @{mechanics_modifiers} skill(@{mechanics_rank}|@{intellect}|Mechanics) @{dicePool}"></button>
        </div>
        <div class="skill">          
          <label data-i18n="medicine">Medicine</label>
          <div>(<span data-i18n="intellect_abbr">Int</span>)</div>
          <input type="checkbox" name="attr_medicine_career" value="true" />
          <input type="number"  name="attr_medicine_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_medicine_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_medicine_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_medicine_modifiers" />
          <button class="roll_button" type="roll" name="roll_medicine" value="!eed characterID(@{character_id}) label(skill:Medicine) @{medicine_modifiers} skill(@{medicine_rank}|@{intellect}|Medicine) @{dicePool}"></button>
        </div>
        <div class="skill">          
          <label data-i18n="negotiation">Negotiation</label>
          <div>(<span data-i18n="presence_abbr">Pr</span>)</div>
          <input type="checkbox" name="attr_negotiation_career" value="true" />
          <input type="number"  name="attr_negotiation_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_negotiation_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_negotiation_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_negotiation_modifiers" />
          <button class="roll_button" type="roll" name="roll_negotiation" value="!eed characterID(@{character_id}) label(skill:Negotiation) @{negotiation_modifiers} skill(@{negotiation_rank}|@{presence}|Negotiation) @{dicePool}"></button>
        </div>
        <div class="skill">          
          <label data-i18n="perception">Perception</label>
          <div>(<span data-i18n="cunning_abbr">Cun</span>)</div>
          <input type="checkbox" name="attr_perception_career" value="true" />
          <input type="number"  name="attr_perception_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_perception_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_perception_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_perception_modifiers" />
          <button class="roll_button" type="roll" name="roll_perception" value="!eed characterID(@{character_id}) label(skill:Perception) @{perception_modifiers} skill(@{perception_rank}|@{cunning}|Perception) @{dicePool}"></button>
        </div>
        <div class="skill">          
          <label data-i18n="piloting-planetary">Piloting - Planetary</label>
          <div>(<span data-i18n="agility_abbr">Ag</span>)</div>
          <input type="checkbox" name="attr_piloting-planetary_career" value="true" />
          <input type="number"  name="attr_piloting-planetary_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_piloting-planetary_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_piloting-planetary_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_piloting-planetary_modifiers" />
          <button class="roll_button" type="roll" name="roll_piloting-planetary" value="!eed characterID(@{character_id}) label(skill:Piloting - Planetary) @{piloting-planetary_modifiers} skill(@{piloting-planetary_rank}|@{agility}|Piloting - Planetary) @{dicePool}"></button>
        </div>
        <div class="skill">          
          <label data-i18n="piloting-space">Piloting - Space</label>
          <div>(<span data-i18n="agility_abbr">Ag</span>)</div>
          <input type="checkbox" name="attr_piloting-space_career" value="true" />
          <input type="number"  name="attr_piloting-space_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_piloting-space_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_piloting-space_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_piloting-space_modifiers" />
          <button class="roll_button" type="roll" name="roll_piloting-space" value="!eed characterID(@{character_id}) label(skill:Piloting - Space) @{piloting-space_modifiers} skill(@{piloting-space_rank}|@{agility}|Piloting - Space) @{dicePool}"></button>
        </div>
        <div class="skill">          
          <label data-i18n="resilience">Resilience</label>
          <div>(<span data-i18n="brawn_abbr">Bra</span>)</div>
          <input type="checkbox" name="attr_resilience_career" value="true" />
          <input type="number"  name="attr_resilience_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_resilience_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_resilience_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_resilience_modifiers" />
          <button class="roll_button" type="roll" name="roll_resilience" value="!eed characterID(@{character_id}) label(skill:Resilience) @{resilience_modifiers} skill(@{resilience_rank}|@{brawn}|Resilience) @{dicePool}"></button>
        </div>
        <div class="skill">          
          <label data-i18n="skullduggery">Skullduggery</label>
          <div>(<span data-i18n="cunning_abbr">Cun</span>)</div>
          <input type="checkbox" name="attr_skullduggery_career" value="true" />
          <input type="number"  name="attr_skullduggery_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_skullduggery_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_skullduggery_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_skullduggery_modifiers" />
          <button class="roll_button" type="roll" name="roll_skullduggery" value="!eed characterID(@{character_id}) label(skill:Skullduggery) @{skullduggery_modifiers} skill(@{skullduggery_rank}|@{cunning}|Skullduggery) @{dicePool}"></button>
        </div>
        <div class="skill">          
          <label data-i18n="stealth">Stealth</label>
          <div>(<span data-i18n="agility_abbr">Ag</span>)</div>
          <input type="checkbox" name="attr_stealth_career" value="true" />
          <input type="number"  name="attr_stealth_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_stealth_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_stealth_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_stealth_modifiers" />
          <button class="roll_button" type="roll" name="roll_stealth" value="!eed characterID(@{character_id}) label(skill:Stealth) @{stealth_modifiers} skill(@{stealth_rank}|@{agility}|Stealth) @{dicePool}"></button>
        </div>
        <div class="skill">          
          <label data-i18n="streetwise">Streetwise</label>
          <div>(<span data-i18n="cunning_abbr">Cun</span>)</div>
          <input type="checkbox" name="attr_streetwise_career" value="true" />
          <input type="number"  name="attr_streetwise_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_streetwise_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_streetwise_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_streetwise_modifiers" />
          <button class="roll_button" type="roll" name="roll_streetwise" value="!eed characterID(@{character_id}) label(skill:Streetwise) @{streetwise_modifiers} skill(@{streetwise_rank}|@{cunning}|Streetwise) @{dicePool}"></button>
        </div>
        <div class="skill">          
          <label data-i18n="survival">Survival</label>
          <div>(<span data-i18n="cunning_abbr">Cun</span>)</div>
          <input type="checkbox" name="attr_survival_career" value="true" />
          <input type="number"  name="attr_survival_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_survival_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_survival_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_survival_modifiers" />
          <button class="roll_button" type="roll" name="roll_survival" value="!eed characterID(@{character_id}) label(skill:Survival) @{survival_modifiers} skill(@{survival_rank}|@{cunning}|Survival) @{dicePool}"></button>
        </div>
        <div class="skill">          
          <label data-i18n="vigilance">Vigilance</label>
          <div>(<span data-i18n="willpower_abbr">Wil</span>)</div>
          <input type="checkbox" name="attr_vigilance_career" value="true" />
          <input type="number"  name="attr_vigilance_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_vigilance_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_vigilance_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_vigilance_modifiers" />
          <button class="roll_button" type="roll" name="roll_vigilance" value="!eed characterID(@{character_id}) label(skill:Vigilance) @{vigilance_modifiers} skill(@{vigilance_rank}|@{willpower}|Vigilance) @{dicePool}"></button>
        </div>        
      </div>
      <div class="skills_combat">
        <h3>Combat Skills</h3>
        <div class="skill skill_heading">          
          <div data-i18n="skill">Skill</div>
          <div data-i18n="characteristic">Characteristic</div>
          <div data-i18n="career">Career</div>
          <div data-i18n="ranks">Ranks</div>
          <div data-i18n="dice">Dice</div>
          <div data-i18n="modifiers">Modifiers</div>
          <div data-i18n="roll">Roll</div>
        </div>
        <div class="skill">          
          <label data-i18n="brawl">Brawl</label>
          <div>(<span data-i18n="brawn_abbr">Bra</span>)</div>
          <input type="checkbox" name="attr_brawl_career" value="true" />
          <input type="number"  name="attr_brawl_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_brawl_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_brawl_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_brawl_modifiers" />
          <button class="roll_button" type="roll" name="roll_brawl" value="!eed characterID(@{character_id}) label(skill:Brawl) @{brawl_modifiers} skill(@{brawl_rank}|@{brawn}|Brawl) @{dicePool}"></button>
        </div>
        <div class="skill">          
          <label data-i18n="melee">Melee</label>
          <div>(<span data-i18n="brawn_abbr">Bra</span>)</div>
          <input type="checkbox" name="attr_melee_career" value="true" />
          <input type="number"  name="attr_melee_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_melee_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_melee_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_melee_modifiers" />
          <button class="roll_button" type="roll" name="roll_melee" value="!eed characterID(@{character_id}) label(skill:Melee) @{melee_modifiers} skill(@{melee_rank}|@{brawn}|Melee) @{dicePool}"></button>
        </div>
        <div class="skill">          
          <label data-i18n="gunnery">Gunnery</label>
          <div>(<span data-i18n="agility_abbr">Ag</span>)</div>
          <input type="checkbox" name="attr_gunnery_career" value="true" />
          <input type="number"  name="attr_gunnery_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_gunnery_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_gunnery_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_gunnery_modifiers" />
          <button class="roll_button" type="roll" name="roll_gunnery" value="!eed characterID(@{character_id}) label(skill:Gunnery) @{gunnery_modifiers} skill(@{gunnery_rank}|@{agility}|Gunnery) @{dicePool}"></button>
        </div>
        <div class="skill">          
          <label data-i18n="lightsaber">Lightsaber</label>
          <select name="attr_lightsaber_characteristic">
            <option data-i18n="brawn" value="@{brawn}">Brawn</option>
            <option data-i18n="agility" value="@{agility}">Agility</option>
            <option data-i18n="intellect" value="@{intellect}">Intellect</option>
            <option data-i18n="cunning" value="@{cunning}">Cunning</option>
            <option data-i18n="willpower" value="@{willpower}">Willpower</option>
            <option data-i18n="presence" value="@{presence}">Presence</option>
          </select>
          <input type="hidden" name="attr_lightsaber_characteristic_value" value="" />
          <input type="checkbox" name="attr_lightsaber_career" value="true" />
          <input type="number"  name="attr_lightsaber_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_lightsaber_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_lightsaber_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_lightsaber_modifiers" />
          <button class="roll_button" type="roll" name="roll_lightsaber" value="!eed characterID(@{character_id}) label(skill:Lightsaber) @{lightsaber_modifiers} skill(@{lightsaber_rank}|@{lightsaber_characteristic}|Lightsaber) @{dicePool}"></button>
        </div>
        <div class="skill">          
          <label data-i18n="ranged-light">Ranged - Light</label>
          <div>(<span data-i18n="agility_abbr">Ag</span>)</div>
          <input type="checkbox" name="attr_ranged-light_career" value="true" />
          <input type="number"  name="attr_ranged-light_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_ranged-light_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_ranged-light_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_ranged-light_modifiers" />
          <button class="roll_button" type="roll" name="roll_ranged-light" value="!eed characterID(@{character_id}) label(skill:Ranged - Light) @{ranged-light_modifiers} skill(@{ranged-light_rank}|@{agility}|Ranged - Light) @{dicePool}"></button>
        </div>
        <div class="skill">          
          <label data-i18n="ranged-heavy">Ranged - Heavy</label>
          <div>(<span data-i18n="agility_abbr">Ag</span>)</div>
          <input type="checkbox" name="attr_ranged-heavy_career" value="true" />
          <input type="number"  name="attr_ranged-heavy_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_ranged-heavy_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_ranged-heavy_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_ranged-heavy_modifiers" />
          <button class="roll_button" type="roll" name="roll_ranged-heavy" value="!eed characterID(@{character_id}) label(skill:Ranged - Heavy) @{ranged-heavy_modifiers} skill(@{ranged-heavy_rank}|@{agility}|Ranged - Heavy) @{dicePool}"></button>
        </div>
      </div>
      <div class="skills_knowledge">
        <h3>Knowledge Skills</h3>
        <div class="skill skill_heading">          
          <div data-i18n="skill">Skill</div>
          <div data-i18n="characteristic">Characteristic</div>
          <div data-i18n="career">Career</div>
          <div data-i18n="ranks">Ranks</div>
          <div data-i18n="dice">Dice</div>
          <div data-i18n="modifiers">Modifiers</div>
          <div data-i18n="roll">Roll</div>
        </div>
        <div class="skill">          
          <label data-i18n="core-worlds">Core Worlds</label>
          <div>(<span data-i18n="intellect_abbr">Int</span>)</div>
          <input type="checkbox" name="attr_core-worlds_career" value="true" />
          <input type="number"  name="attr_core-worlds_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_core-worlds_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_core-worlds_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_core-worlds_modifiers" />
          <button class="roll_button" type="roll" name="roll_core-worlds" value="!eed characterID(@{character_id}) label(skill:Core Worlds) @{core-worlds_modifiers} skill(@{core-worlds_rank}|@{intellect}|Core Worlds) @{dicePool}"></button>
        </div>
        <div class="skill">          
          <label data-i18n="education">Education</label>
          <div>(<span data-i18n="intellect_abbr">Int</span>)</div>
          <input type="checkbox" name="attr_education_career" value="true" />
          <input type="number"  name="attr_education_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_education_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_education_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_education_modifiers" />
          <button class="roll_button" type="roll" name="roll_education" value="!eed characterID(@{character_id}) label(skill:Education) @{education_modifiers} skill(@{education_rank}|@{intellect}|Education) @{dicePool}"></button>
        </div>
        <div class="skill">          
          <label data-i18n="lore">Lore</label>
          <div>(<span data-i18n="intellect_abbr">Int</span>)</div>
          <input type="checkbox" name="attr_lore_career" value="true" />
          <input type="number"  name="attr_lore_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_lore_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_lore_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_lore_modifiers" />
          <button class="roll_button" type="roll" name="roll_lore" value="!eed characterID(@{character_id}) label(skill:Lore) @{lore_modifiers} skill(@{lore_rank}|@{intellect}|Lore) @{dicePool}"></button>
        </div>
        <div class="skill">          
          <label data-i18n="outer-rim">Outer Rim</label>
          <div>(<span data-i18n="intellect_abbr">Int</span>)</div>
          <input type="checkbox" name="attr_outer-rim_career" value="true" />
          <input type="number"  name="attr_outer-rim_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_outer-rim_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_outer-rim_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_outer-rim_modifiers" />
          <button class="roll_button" type="roll" name="roll_outer-rim" value="!eed characterID(@{character_id}) label(skill:Outer Rim) @{outer-rim_modifiers} skill(@{outer-rim_rank}|@{intellect}|Outer Rim) @{dicePool}"></button>
        </div>
        <div class="skill">          
          <label data-i18n="underworld">Underworld</label>
          <div>(<span data-i18n="intellect_abbr">Int</span>)</div>
          <input type="checkbox" name="attr_underworld_career" value="true" />
          <input type="number"  name="attr_underworld_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_underworld_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_underworld_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_underworld_modifiers" />
          <button class="roll_button" type="roll" name="roll_underworld" value="!eed characterID(@{character_id}) label(skill:Underworld) @{underworld_modifiers} skill(@{underworld_rank}|@{intellect}|Underworld) @{dicePool}"></button>
        </div>
        <div class="skill">          
          <label data-i18n="xenology">Xenology</label>
          <div>(<span data-i18n="intellect_abbr">Int</span>)</div>
          <input type="checkbox" name="attr_xenology_career" value="true" />
          <input type="number"  name="attr_xenology_rank" min="0" max="6" maxlength="1" value="0" />
          <div class="skill_rank_boxes">
            <input class="yd" type="hidden" name="attr_xenology_yd" value="" />
            <span class="icon-proficiency-dice"></span>
            <input class="gd" type="hidden" name="attr_xenology_gd" value="" />
            <span class="icon-ability-dice"></span>            
          </div>
          <input type="text" name="attr_xenology_modifiers" />
          <button class="roll_button" type="roll" name="roll_xenology" value="!eed characterID(@{character_id}) label(skill:Xenology) @{xenology_modifiers} skill(@{xenology_rank}|@{intellect}|Xenology) @{dicePool}"></button>
        </div> 
      </div>
    </div>
  </div>
  <div class="sheet-combat">
    <h2 data-i18n="initiative">Initiative</h2>
    <div class="initiative section">
      <div class="skill skill_cool">          
        <label class="cell_width_3" data-i18n="cool_if_prepared">Cool (if prepared)</label>
        <div>(<span data-i18n="presence_abbr">Pr</span>)</div>
        <div class="skill_rank_boxes">
          <input class="yd" type="hidden" name="attr_init_cool_yd" value="(((@{presence} + @{cool_rank}) - abs(@{presence} - @{cool_rank})) / 2)" disabled />
          <span class="icon-proficiency-dice"></span>
          <input class="gd" type="hidden" name="attr_init_cool_gd" value="((((@{presence} + @{cool_rank}) + abs(@{presence} - @{cool_rank})) / 2) - @{cool_yd})" disabled />
          <span class="icon-ability-dice"></span>            
        </div>
        <input type="text" name="attr_init_cool_modifiers" />
        <button class="roll_button" type="roll" name="attr_roll_init_cool" value="!eed characterID(@{character_id}) label(skill:Initiative Cool) @{cool_modifiers} @{init_cool_modifiers} skill(@{cool_rank}|@{presence}|Cool) @{dicePool}"></button>
      </div>
      <div class="skill skill_vigilance">          
        <label class="cell_width_3" data-i18n="vigilance_if_unexpected">Vigilance (if unexpected)</label>
        <div>(<span data-i18n="willpower_abbr">Wil</span>)</div>
        <div class="skill_rank_boxes">
          <input class="yd" type="hidden" name="attr_init_vigilance_yd" value="(((@{willpower} + @{vigilance_rank}) - abs(@{willpower} - @{vigilance_rank})) / 2)" disabled />
          <span class="icon-proficiency-dice"></span>
          <input class="gd" type="hidden" name="attr_init_vigilance_gd" value="((((@{willpower} + @{vigilance_rank}) + abs(@{willpower} - @{vigilance_rank})) / 2) - @{vigilance_yd})" disabled />
          <span class="icon-ability-dice"></span>            
        </div>
        <input type="text" name="attr_init_vigilance_modifiers" />
        <button class="roll_button" type="roll" name="attr_roll_init_vigilance" value="!eed characterID(@{character_id}) label(skill:Initiative Vigilance) @{vigilance_modifiers} @{init_vigilance_modifiers} skill(@{vigilance_rank}|@{willpower}|Vigilance) @{dicePool}"></button>
      </div>
    </div>
    <h2 data-i18n="criticals">Criticals</h2>
    <div class="criticals section">
      <h3 data-i18n="roll_critical">Roll Critical</h3>
      <div class="rolla_critical">
        <div>Roll Critcal Hit</div>
        <div>Crit Bonus</div>
        <div><button>Roll</button></div>
      </div>
      <h3 data-i18n="current_critical_injuries">Current Critical Injuries</h3>
      <fieldset class="repeating_critical_injuries">
        <div class="current_crits">
          <select>
            <optgroup label="Easy (1 ♦)">
              <option name="attr_crit_1" value="Minor Nick: Suffer 1 strain.">1 - 5</option>
              <option name="attr_crit_2" value="Slowed Down: May only act during last allied Initiative slot on next turn.">6 - 10</option>
              <option name="attr_crit_3" value="Sudden Jolt: May only act during last hero Initiative slot on next turn.">11 - 15</option>
              <option name="attr_crit_4" value="Distracted: Cannot perform free maneuver on next turn.">16 - 20</option>
              <option name="attr_crit_5" value="Off-Balance: Add 1 Setback die to next skill check.">21 - 25</option>
              <option name="attr_crit_6" value="Discouraging Wound: Flip one light destiny to dark.">26 - 30</option>
              <option name="attr_crit_7" value="Stunned: Staggered, cannot perform action on next turn.">31 - 35</option>
              <option name="attr_crit_8" value="Stinger: Increase difficulty of next check by 1 Difficulty die.">36 - 40</option>
            </optgroup>
            <optgroup label="Average (2 ♦♦)">

            </optgroup>
            <optgroup label="Hard (3 ♦♦♦)">

            </optgroup>
            <optgroup label="Daunting (4 ♦♦♦♦)">

            </optgroup>
            <option>0-10</option>
          </select>
          <select>
            <option>Easy (1 ♦)</option>
            <option>Average (2 ♦♦)</option>
            <option>Hard (3 ♦♦♦)</option>
            <option>Daunting (4 ♦♦♦♦)</option>
          </select>        
          <div>
            <select name="attr_crit_characteristic">
              <option data-i18n="none" value="">None</option>
              <option data-i18n="brawn" value="brawn">Brawn</option>
              <option data-i18n="agility" value="agility">Agility</option>
              <option data-i18n="intellect" value="intellect">Intellect</option>
              <option data-i18n="cunning" value="cunning">Cunning</option>
              <option data-i18n="willpower" value="willpower">Willpower</option>
              <option data-i18n="presence" value="presence">Presence</option>
              <option data-i18n="all" value="all">All</option>
            </select>
          </div>
          <div><input type="text" value="modifiers" /></div>
          <div class="cell-width-4">Description</div>
        </div>
      </fieldset>
    </div>
    <h2 data-i18n="weapons">Weapons</h2>
    <div class="weapons section">
      <fieldset class="repeating_weapons">
        <div class="weapon">
          <h3 class="weapon_name"><span name="attr_make_model">Make/Model</span></h3>
          <div class="weapon_stats">
            <div>
              <label data-i18n="damage">Damage</label>
              <input type="number" name="attr_weapon_damage" max="20" min="0" value="0" />
            </div>
            <div>
              <label data-i18n="critical">Critical</label>
              <input type="number" name="attr_weapon_critical" max="9" min="0" value="0" />
            </div>
            <button name="roll_weapon" type="roll" value="!eed characterID(@{character_id}) label(Weapon:@{make_model}|Type:@{weapon_skill}|Damage:@{weapon_damage}|Critical:@{weapon_critical}|Range:@{weapon_range}|Qualities:@{weapon_qualities_list}) @{weapon_skill_value} @{weapon_condition} @{weapon_qualities_pool} @{dicePool} calculateDamage(@{weapon_damage}|@{weapon_critical}|@{weapon_damage_bonus}|@{weapon_critical_bonus})"></button>
            <div>
              <label data-i18n="encumbrance_abbr">Encum</label>
              <input type="number" name="attr_weapon_encumbrance" max="9" min="0" value="0" />
            </div>
            <div>
              <label data-i18n="hard_points">Hard Points</label>
              <input type="number" name="attr_weapon_hard_points" max="9" min="0" value="0" />
            </div>
          </div>
          <div class="weapon_info">
            <label data-i18n="make_model">Make-Model:</label>
            <input type="text" name="attr_make_model" />
            <label data-i18n="skill">Skill:</label>
            <select name="attr_weapon_skill" name="">
              <optgroup label="Combat Skills" data-i18n-label="combat_skills">
                <option value="Brawl" data-i18n="brawl">Brawl</option>
                <option value="Melee" data-i18n="melee">Melee</option>
                <option value="Gunnery" data-i18n="gunnery">Gunnery</option>
                <option value="Ranged - Light" data-i18n="ranged-light">Ranged - Light</option>
                <option value="Ranged - Heavy" data-i18n="ranged-heavy">Ranged - Heavy</option>
                <option value="Lightsaber" data-i18n="lightsaber">Lightsaber</option>
              </optgroup>
              <optgroup label="General Skills" data-i18n-label="general_skills">
                <option value="Mechanics" data-i18n="mechanics">Mechanics</option>
                <option value="Medicine" data-i18n="medecine">Medicine</option>
                <option value="Resilience" data-i18n="resilience">Resilience</option>
              </optgroup>
            </select>
            <input type="hidden" name="attr_weapon_skill_value" value="" />
            <label data-i18n="range">Range:</label>
            <select name="attr_weapon_range">
              <option value="Engaged" data-i18n="engaged">Engaged</option>
              <option value="Short" data-i18n="short">Short</option>
              <option value="Medium" data-i18n="medium">Medium</option>
              <option value="Long" data-i18n="long">Long</option>
              <option value="Extreme" data-i18n="extreme">Extreme</option>
            </select>
            <label data-i18n="condition">Condition:</label>
            <select name="attr_weapon_condition">
              <option value="" data-i18n="undamaged">Undamaged</option>
              <option value="1blk" data-i18n="minor">Minor</option>
              <option value="1p" data-i18n="moderate">Moderate</option>
              <option value="unusableWeapon" data-i18n="major">Major</option>
              <option value="unusableWeapon" data-i18n="destroyed">Destroyed</option>
            </select>
            <label data-i18n="critical_bonus">Critical Bonus:</label>
            <input name="attr_weapon_critical_bonus" type="number" step="10" value="0" min="0" max="100" />
            <label data-i18n="damage_bonus:">Damage Bonus:</label>
            <input name="attr_weapon_damage_bonus" type="number" value="0" min="-10" max="10" />
          </div>
          <h3 class="weapon_qualities_header"><span data-i18n="weapon_qualities">Weapon Qualities</span> <span class="weapon_qualities_activation_icon"></span><span class="weapon_qualities_activation" data-i18n="two_advantage_to_activate">Two Advantage to activate unless otherwise noted</span></h3>
          <input type="hidden" name="attr_weapon_qualities_pool" value="@{weapon_quality_accurate_value}b @{weapon_quality_inaccurate_value}blk @{weapon_quality_cumbersome_penalty}p" />
          <input type="hidden" name="attr_weapon_qualities_list" value="None" />
          <div class="weapon_qualities">            
            <label><span data-i18n="accurate">Accurate</span><span class="icon_passive" title="Passive" data-i18n-title="passive"></span><span class="icon_help" title="Help" data-i18n-title="help"></span>
              <div class="help_info">
                <p>Accurate weapons are easier to aim or wield, whether through design or technology. For each level of this trait, the attacker adds 1 blue to his attack dice pools while using this weapon.</p>
              </div>
            </label>
            <input name="attr_weapon_quality_accurate_value" type="number" value="0" min="0" max="9" />
            <label><span data-i18n="auto_fire">Auto-Fire</span><span class="icon_active" title="Active" data-i18n-title="active"></span><span class="icon_help" title="Help" data-i18n-title="help"></span>
              <div class="help_info">
                <p>A weapon with Auto-fire can be set to shoot in rapid succession and potentially spray an area with bolts, flechettes, slugs, or other types of projectiles. The advantage in using Auto-fire is that it has the chance to hit multiple targets or hit a single target multiple times.</p>
                <p>Attacking with a weapon on Auto-fire is generally less accurate, and the attacker must increase the difficulty of the attack check by 1 purple die. The user may choose to not use the Auto-fire quality on a weapon; in this case, he cannot trigger the quality but also does not suffer the aforementioned penalty.</p>
                <p>If the attack hits, the attacker can trigger Auto-fire by spending 2 Advantages Auto-fire can be triggered multiple times. Each time the attacker triggers Autofire, it deals an additional hit to the target. Each of these counts as an additional hit from that weapon, and each hit deals base damage plus the number of uncanceled success on the check.</p>
                <p>These additional hits can be allocated to the target, or to other targets within range of the weapon. If the attacker wishes to hit multiple targets, he must deci to do so before making the check. Furthermore, if h wishes to hit multiple targets, his initial target must always be the target with the highest difficulty and highest defense (if this is two separate targets, the GM chooses which target is the initial target). The initial hit must always be against the initial target. Subsequent hits generated can be allocated to any of the other designated targets.</p>
                <p>Auto-fire weapons can also activate one Critical Injury for each hit generated on the attack per the normal cost; the Critical must target the target of the specific hit.</p>
              </div>
            </label>
            <select name="attr_weapon_quality_auto_fire_value">
              <option data-i18n="no">No</option>
              <option data-i18n="yes">Yes</option>
            </select>
            <label><span data-i18n="blast">Blast</span><span class="icon_active" title="Active" data-i18n-title="active"></span><span class="icon_help" title="Help" data-i18n-title="help"></span>
              <div class="help_info">
                <p>The weapon has a large spread, an explosive blast, or similar area of effect, like the detonation of a grenade or a warhead fired from a missile launcher. If the attack is successful and Blast activates, each character (friend or foe) engaged with the original target suffers damage equal to the weapon's Blast rating (plus an additional wound per success as usual).</p>
                <p>In a relatively small and enclosed area, the Game Master might decide that everyone in the room suffers damage.</p>
                <p>If the Blast quality doesn't activate, the ordnance still detonates, but bad luck or poor aim on the part of the firer (or quick reactions on the part of the victims) means the explosion may not catch anyone else in its radius. However, the user may also trigger Blast if the attack misses by spending 3 advantages. In this case, the original target and every target engaged with the original target suffers damage equal to the Blast rating of the weapon.</p>
              </div>
            </label>
            <input name="attr_weapon_quality_blast_value" type="number" value="0" min="0" max="9" />
            <label><span data-i18n="breach">Breach</span><span class="icon_passive" title="Passive" data-i18n-title="passive"></span><span class="icon_help" title="Help" data-i18n-title="help"></span>
              <div class="help_info">
                <p>Weapons with Breach burn through the toughest armor, and are often heavy weapons or starship weapons.</p>
                <p>Breach weapons ignore one point of armor for every rating of Breach (meaning they also ignore 10 points of soak for every rating of Breach).</p>
              </div>
            </label>
            <input name="attr_weapon_quality_breach_value" type="number" value="0" min="0" max="9" />
            <label><span data-i18n="burn">Burn</span><span class="icon_active" title="Active" data-i18n-title="active"></span><span class="icon_help" title="Help" data-i18n-title="help"></span>
              <div class="help_info">
                <p>Weapons with Burn inflict damage over time. If the attack is successful, the target continues to suffer the weapon's base damage each round for a number of rounds equal to the weapon's Burn rating. Damage is applied at the start of each of the target's turns.</p>
                <p>A victim might be able to stop the damage by rolling around on the ground and making an Agility check as an action. This is an Average (2 purple dice) Coordination check on hard surfaces such as the hall of a spaceship, or an Easy (1 purple die) Coordination check on grass or soft ground. Jumping into a body of water stops the damage immediately. Both situations assume the flame is from actual combustion rather than a chemical reaction. With the latter, there is usually little the victim can do.</p>
              </div>
            </label>
            <input name="attr_weapon_quality_burn_value" type="number" value="0" min="0" max="9" />
            <label><span data-i18n="concussive">Concussive</span><span class="icon_active" title="Active" data-i18n-title="active"></span><span class="icon_help" title="Help" data-i18n-title="help"></span>
              <div class="help_info">
                <p>The weapon's attack can leave the target shell-shocked from mighty blows or punishing Shockwaves, unable to perform any but the most basic actions. The target is staggered for a number of rounds equal to the weapon's Concussive rating. A staggered target cannot perform actions.</p>
              </div>
            </label>
            <input name="attr_weapon_quality_concussive_value" type="number" value="0" min="0" max="9" />
            <label><span data-i18n="cortosis">Cortosis</span><span class="icon_passive" title="Passive" data-i18n-title="passive"></span><span class="icon_help" title="Help" data-i18n-title="help"></span>
              <div class="help_info">
                <p>Cortosis is an ore principally found in the Outer Rim. It is extremely rare and valuable, and was used primarily during the Clone Wars against the Jedi Knights. There are two varieties of Cortosis ore. The rarest versions can actually short out a lightsaber's blade, causing it to fail temporarily. The far more common Cortosis ore is still a miraculous substance, because when molded into armor, it forms an interlocking molecular bond that is extremely resistant to energy weapons.</p>
                <p>Weapons with the Cortosis quality are immune to the Sunder quality. Armor with the Cortosis quality makes the wearer's soak immune to the Pierce and Breach qualities.</p>
              </div>
            </label>
            <select name="attr_weapon_quality_cortosis_value">
              <option data-i18n="no">No</option>
              <option data-i18n="yes">Yes</option>
            </select>
            <label><span data-i18n="cumbersome">Cumbersome</span><span class="icon_passive" title="Passive" data-i18n-title="passive"></span><span class="icon_help" title="Help" data-i18n-title="help"></span>
              <div class="help_info">
                <p>A Cumbersome weapon is large, unwieldy, awkward, or heavy. To wield a Cumbersome weapon properly, the character needs a Brawn characteristic equal to or greater than the weapon's Cumbersome rating. For each point of Brawn by which the character is deficient, he must increase the difficulty of all checks made while using the weapon by one.</p>
              </div>
            </label>            
            <input type="hidden" name="attr_weapon_quality_cumbersome_penalty" value="" />
            <input name="attr_weapon_quality_cumbersome_value" type="number" value="0" min="0" max="9" />
            <label><span data-i18n="defensive">Defensive</span><span class="icon_passive" title="Passive" data-i18n-title="passive"></span><span class="icon_help" title="Help" data-i18n-title="help"></span>
              <div class="help_info">
                <p>Defensive weapons are particularly good at fending off incoming melee attacks. A character wielding a weapon with the Defensive quality increases his melee defense by the weapon's Defensive rating.</p>
              </div>
            </label>
            <input name="attr_weapon_quality_defensive_value" type="number" value="0" min="0" max="9" />
            <label><span data-i18n="deflection">Deflection</span><span class="icon_passive" title="Passive" data-i18n-title="passive"></span><span class="icon_help" title="Help" data-i18n-title="help"></span>
              <div class="help_info">
                <p>An item with the Deflection quality increases the wearer's ranged defense equal to its Deflection rating.</p>
              </div>
            </label>
            <input name="attr_weapon_quality_deflection_value" type="number" value="0" min="0" max="9" />
            <label><span data-i18n="disorient">Disorient</span><span class="icon_active" title="Active" data-i18n-title="active"></span><span class="icon_help" title="Help" data-i18n-title="help"></span>
              <div class="help_info">
                <p>A weapon with Disorient can daze an opponent. When Disorient is triggered, the target is disoriented for a number of rounds equal to the weapon's Disorient rating. (A disoriented target adds 1 black die to all skill checks he performs.)</p>
              </div>
            </label>
            <input name="attr_weapon_quality_disorient_value" type="number" value="0" min="0" max="9" />
            <label><span data-i18n="ensnare">Ensnare</span><span class="icon_active" title="Active" data-i18n-title="active"></span><span class="icon_help" title="Help" data-i18n-title="help"></span>
              <div class="help_info">
                <p>A weapon with Ensnare binds a foe and restricts his movements. When Ensnare is triggered, the target is immobilized for a number of rounds equal to the weapon's Ensnare rating. An Ensnared target may attempt a Hard (3 purple dice) Athletics check as his action on his turn to break free from the effect. (An immobilized target cannot perform maneuvers.)</p>
              </div>
            </label>
            <input name="attr_weapon_quality_ensnare_value" type="number" value="0" min="0" max="9" />  
            <label><span data-i18n="guided">Guided</span><span class="icon_active" title="Active" data-i18n-title="active"></span><span class="icon_help" title="Help" data-i18n-title="help"></span>
              <div class="help_info">
                <p>Certain types of projectiles, such as guided missiles, may benefit from course alterations after being fired. If a character misses while firing a Guided weapon and if Guided is activated, he may make an attack check at the end of the round. The difficulty of the check is calculated by comparing the weapon's silhouette of 0 to the silhouette of the target, and the check's green die equal the weapon's Guided rating. If the test is successful, the weapon strikes the target, and damage is dealt normally.</p>
                <p>Guided requires 3 advantages to activate, unless otherwise specified in the weapon's description. Remember, the Guided effect can activate on its subsequent attacks, representing the projectile continuing to track the target.</p>
                <p>"Spoofing" is a countermeasure designed to work against a particular type of projectile, such as flares designed to draw off infrared missiles. Spoofing directly increases the defense of the target against attacks with the Guided quality.</p>
              </div>
            </label>
            <input name="attr_weapon_quality_guided_value" type="number" value="0" min="0" max="9" />
            <label><span data-i18n="knockdown">Knockdown</span><span class="icon_active" title="Active" data-i18n-title="active"></span><span class="icon_help" title="Help" data-i18n-title="help"></span>
              <div class="help_info">
                <p>When knockdown triggers, the target is knocked prone. Unless specified otherwise, Knockdown requires 2 advantages to trigger, plus one additional advantage per silhouette of the target beyond one. </p>
              </div>
            </label>
            <select name="attr_weapon_quality_knockdown_value">
              <option data-i18n="no">No</option>
              <option data-i18n="yes">Yes</option>
            </select>
            <label><span data-i18n="inaccurate">Inaccurate</span><span class="icon_passive" title="Passive" data-i18n-title="passive"></span><span class="icon_help" title="Help" data-i18n-title="help"></span>
              <div class="help_info">
                <p>Inaccurate weapons are weapons of a shoddy or inferior construction, which means they are less likely to be accurate or precise. Alternatively, the weapon's nature may inhibit accuracy. Inaccurate weapons add 1 black die to the attacker's dice pool equal to their Inaccurate rating. </p>
              </div>
            </label>
            <input name="attr_weapon_quality_inaccurate_value" type="number" value="0" min="0" max="9" />
            <label><span data-i18n="inferior">Inferior</span><span class="icon_passive" title="Passive" data-i18n-title="passive"></span><span class="icon_help" title="Help" data-i18n-title="help"></span>
              <div class="help_info">
                <p>An Inferior item is a lackluster example of its kind, representing shoddy and poor craftsmanship. An Inferior weapon generates automatic 1 disadvantage on all checks related to its use, and has its base damage decreased by one. Inferior armor has its encumbrance increased by one and its defense decreased by one. If it does not have defense, decrease its soak value by one, to a minimum of zero.</p>
              </div>
            </label>
            <select name="attr_weapon_quality_inferior_value">
              <option data-i18n="no">No</option>
              <option data-i18n="yes">Yes</option>
            </select>
            <label><span data-i18n="ion">Ion</span><span class="icon_passive" title="Passive" data-i18n-title="passive"></span><span class="icon_help" title="Help" data-i18n-title="help"></span>
              <div class="help_info">
                <p>Ion weapons are designed to affect electrical systems instead of dealing raw damage. They are fitted to ships to knock out opponents' shields, sensors, and engines. They are shorter range than laser weapons and deal larger amounts of damage, but their damage is dealt to the target (usually a vehicle) as system strain. The damage is still reduced by armor and soak. Droids are affected by ion weapons, taking damage to their strain threshold.</p>
              </div>
            </label>
            <select name="attr_weapon_quality_ion_value">
              <option data-i18n="no">No</option>
              <option data-i18n="yes">Yes</option>
            </select>
            <label><span data-i18n="limited_ammo">Limited Ammo</span><span class="icon_passive" title="Passive" data-i18n-title="passive"></span><span class="icon_help" title="Help" data-i18n-title="help"></span>
              <div class="help_info">
                <p>Some weapons fire particularly large or complex projectiles that cost significant numbers of credits or are themselves a complete weapon that, once launched, is expended. A weapon with the Limited Ammo quality may be used to make a number of attacks equal to its Limited Ammo rating before it must be reloaded with a maneuver. In addition, each shot expends one of a limited number of rounds of ammo, which, once used, must be purchased or otherwise obtained before firing the weapon again. This also applies to grenades and other "one use" weapons that have the Limited Ammo 1 quality (here, the user is not "reloading" the grenade, but drawing another to use—but mechanically they are equivalent).</p>
              </div>
            </label>
            <input name="attr_weapon_quality_limited_ammo_value" type="number" value="0" min="0" max="9" />
            <label><span data-i18n="linked">Linked</span><span class="icon_active" title="Active" data-i18n-title="active"></span><span class="icon_help" title="Help" data-i18n-title="help"></span>
              <div class="help_info">
                <p>Some weapons, like the laser cannons fitted to the X-wing, are designed to fire together at the same target. This increases the possibility of a hit as well as the damage dealt. When firing a linked weapon, on a successful attack, the weapon deals one hit. The wielder may spend 2 advantages to gain an additional hit, and may do so a number of times equal to the weapon's Linked rating. Additional hits from the Linked weapon being used may only be applied against the original target. Each hit deals the weapon's base damage plus the total uncanceled successes scored on the check. </p>
              </div>
            </label>
            <select name="attr_weapon_quality_linked_value">
              <option data-i18n="no">No</option>
              <option data-i18n="yes">Yes</option>
            </select>
            <label><span data-i18n="pierce">Pierce</span><span class="icon_passive" title="Passive" data-i18n-title="passive"></span><span class="icon_help" title="Help" data-i18n-title="help"></span>
              <div class="help_info">
                <p>An attack made with this weapon ignores one point of soak for each rank of Pierce. If the weapon has more ranks of Pierce than the target's total soak, it completely ignores the target's soak. For example. Pierce 3 against a soak of 2 ignores 2 points of soak, but the extra "point" of Pierce has no further effect. </p>
              </div>
            </label>
            <input name="attr_weapon_quality_pierce_value" type="number" value="0" min="0" max="9" />
            <label><span data-i18n="prepare">Prepare</span><span class="icon_passive" title="Passive" data-i18n-title="passive"></span><span class="icon_help" title="Help" data-i18n-title="help"></span>
              <div class="help_info">
                <p>Weapons with this quality require time to set up before being used. The user must perform a number of preparation maneuvers equal to the weapon's Prepare rating before making attacks with that weapon.</p>
              </div>
            </label>
            <input name="attr_weapon_quality_prepare_value" type="number" value="0" min="0" max="9" />
            <label><span data-i18n="slow_firing">Slow-Firing</span><span class="icon_passive" title="Passive" data-i18n-title="passive"></span><span class="icon_help" title="Help" data-i18n-title="help"></span>
              <div class="help_info">
                <p>Slow-Firing weapons tend to be large, heavy, emplacement-mounted weapons like the turbolasers found on capital ships or planetary defense ion cannons. While they deal incredible damage, they need time to recharge or cool down between shots. A weapon's Slow-Firing rating dictates how quickly the weapon can be fired after an attack. For example, a heavy turbolaser with Slow-Firing 2 must wait two rounds after being fired before it can be fired again.</p>
              </div>
            </label>
            <input name="attr_weapon_quality_slow_firing_value" type="number" value="0" min="0" max="9" />
            <label><span data-i18n="stun">Stun</span><span class="icon_passive" title="Passive" data-i18n-title="passive"></span><span class="icon_help" title="Help" data-i18n-title="help"></span>
              <div class="help_info">
                <p>Some weapons deal Stun damage instead of regular damage. In this case, the weapon deals damage as strain instead of wounds. This damage is still reduced by a target's soak.</p>
                <p>A variant of this is a Stun setting. As an incidental, the wielder can choose to switch the setting of his weapon to "Stun." In this case, it does Stun damage as described above. When weapons with a Stun setting are used to deal Stun damage, their range changes to short and cannot be increased.</p>
              </div>
            </label>
            <select name="attr_weapon_quality_stun_damage_value">
              <option data-i18n="no">No</option>
              <option data-i18n="yes">Yes</option>
            </select>
            <label><span data-i18n="sunder">Sunder</span><span class="icon_active" title="Active" data-i18n-title="active"></span><span class="icon_help" title="Help" data-i18n-title="help"></span>
              <div class="help_info">
                <p>When activated, the attacker chooses one item openly wielded by the target (such as a weapon, shield, or item on a belt). That item is damaged one step: to minor if undamaged, from minor to moderate, or from moderate to major. If a weapon already suffering major damage is the target of a successful Sunder, it is destroyed.</p>
                <p>Sunder requires 1 advantage to activate. If activated multiple times in the same attack, each activation can be applied against the same weapon, potentially taking a weapon from undamaged to destroyed in a single attack.</p>
              </div>
            </label>
            <select name="attr_weapon_quality_sunder_value">
              <option data-i18n="no">No</option>
              <option data-i18n="yes">Yes</option>
            </select>
            <label><span data-i18n="superior">Superior</span><span class="icon_passive" title="Passive" data-i18n-title="passive"></span><span class="icon_help" title="Help" data-i18n-title="help"></span>
              <div class="help_info">
                <p>A Superior item is a sterling example of its kind, representing masterful craftsmanship. A Superior weapon generates automatic 1 advantage on all checks related to its use, and has its base damage increased by one. Superior armor has its encumbrance reduced by one and its soak value increased by one. </p>
              </div>
            </label>
            <select name="attr_weapon_quality_superior_value">
              <option data-i18n="no">No</option>
              <option data-i18n="yes">Yes</option>
            </select>
            <label><span data-i18n="vicious">Vicious</span><span class="icon_passive" title="Passive" data-i18n-title="passive"></span><span class="icon_help" title="Help" data-i18n-title="help"></span>
              <div class="help_info">
                <p>When this weapon scores a Critical Injury or Hit, the character adds ten times the Vicious rating to the Critical roll. With Vicious 3, for example, the victim adds + 30 to his Critical Hit result.</p>
              </div>
            </label>
            <input name="attr_weapon_quality_vicious_value" type="number" value="0" min="0" max="9" />
          </div>
          <h3 data-i18n="modifications">Modifications</h3>
          <textarea class="weapon_mods" name="attr_weapon_mods"></textarea>
        </div>
      </fieldset>          
    </div>
    <h2 data-i18n="combat_talents">Combat Talents</h2>
    <div class="combat_talents section">
      <fieldset class="repeating_combat_talents">
        <div>Talent - calculate stat/skill enhancements if applicable</div>
      </fieldset>
    </div>
    <h2 data-i18n="armor">Armor</h2>
    <div class="armor section">
      <fieldset class="repeating_armor">
        <div>Armor - calculate extra Soak and Defense</div>
      </fieldset>
    </div>   
  </div>
  <div class="sheet-equipment">
    <h2 data-i18n="gear">Gear</h2>
    <div class="gear section">
      <fieldset class="repeating_gear">
        <div>Gear - calculate stat/skill enhancements if applicable</div>
      </fieldset>
    </div>
    <h2 data-i18n="cybernetics">Cybernetics</h2>
    <div class="cybernetics section">
      <fieldset class="repeating_cybernetics">
        <div>Cybernetics - calculate stat/skill enhancements if applicable</div>
      </fieldset>
    </div>  
  </div>
  <div class="sheet-talents">
    <h2 data-i18n="non_combat_talents">Non-combat Talents</h2>
    <div class="non_combat_talents section">
      <fieldset class="repeating_non_combat_talents">
        <div>Non-combat Talent - calculate stat/skill enhancements if applicable</div>
      </fieldset>
    </div>
    <h2 data-i18n="signature_abilities">Signature Abilities</h2>
    <div class="signature_abilities section">
      <fieldset class="repeating_signature_abilities">
        <div>Signature Ability - calculate stat/skill enhancements if applicable</div>
      </fieldset>
    </div>   
  </div>
  <div class="sheet-force">
    <h2 data-i18n="force_powers">Force Powers</h2>
    <div class="force_powers section">
      <fieldset class="repeating_force_powers">
        <div>Force Power - calculate stat/skill enhancements if applicable</div>
      </fieldset>
    </div>    
  </div>
  <!-- General Settings -->
  <div class="sheet-settings">
    <h2 data-i18n="roll_result_suggestions">Roll Result Suggestions</h2>
    <div class="settings_result_suggestions section">
      <div data-i18n="setting">Setting</div>
      <div data-i18n="option">Option</div>
      <div data-i18n-title="select_skill_suggestions" title="Change the handling for skill suggestions" data-i18n="skill_suggestions_display">Skill Suggestions Display</div>
      <select name="attr_skill_suggestion_setting_display">
        <option value="none" data-i18n="none">None</option>
        <option value="whisper" data-i18n="whisper_gm">Whisper GM</option>
        <option value="button" data-i18n="show_suggestions_button">Show Suggestions Button</option>
        <option value="always" data-i18n="display_inskill" selected>Display in Skill</option>
      </select>
      <div data-i18n-title="select_combat_suggestions" title="Enable suggestions for rolls made from the weapon combat section or vehicle sheet" data-i18n="enable_combat_suggestions">Enable Combat Suggestions?</div>
      <select name="attr_skill_suggestion_setting_combat">
        <option value="0" data-i18n="no" selected>No</option>
        <option value="1" data-i18n="yes">Yes</option>
      </select>
      <div data-i18n-title="select_general_suggestions" title="Enable suggestions for rolls made from the general skill list" data-i18n="enable_general_suggestions">Enable General Suggestions?</div>
      <select name="attr_skill_suggestion_setting_general">
        <option value="0" data-i18n="no" selected>No</option>
        <option value="1" data-i18n="yes">Yes</option>
      </select>
      <div data-i18n-title="select_fear_check" title="Allows Discipline and Cool skill checks to pull suggestions from the fear suggestion list." data-i18n="fear_check">Fear Check?</div>
      <select name="attr_skill_suggestion_setting_fear">
        <option value="0" selected data-i18n="no">No</option>
        <option value="1" data-i18n="yes">Yes</option>
      </select>
    </div>    
  </div>
  <!-- End General Settings -->
</div>

<rolltemplate class="sheet-rolltemplate-base">
  <table>
      <tr><th colspan="2">{{title}} {{#subtitle}}<br /><span class="subheader">{{subtitle}}</span>{{/subtitle}}</th></tr>
      {{#flavor}}
      <tr><td colspan="2"><span class="flavor">{{flavor}}</span></td></tr>
      {{/flavor}}
      {{#prewide}}
      <tr><td colspan="2">{{prewide}}</td></tr>
      {{/prewide}}
      {{#header}}
      <tr><td class="tcat-header"><span>{{header}}</span></td><td class="tcat-header"><span>{{item}}</span></td></tr>
      {{/header}}
      {{#allprops() title flavor wide roll results subtitle header item prewide wide2 wide3 wide4 wide5}}
      <tr><td><span class="sheet-tcat">{{key}}</span></td><td>{{value}}</td></tr>
      {{/allprops() title flavor wide roll results subtitle header item prewide wide2 wide3 wide4 wide5}}
      {{#wide}}
      <tr><td colspan="2">{{wide}}</td></tr>
      {{/wide}}
      {{#wide2}}
      <tr><td colspan="2">{{wide2}}</td></tr>
      {{/wide2}}
      {{#wide3}}
      <tr><td colspan="2">{{wide3}}</td></tr>
      {{/wide3}}
      {{#wide4}}
      <tr><td colspan="2">{{wide4}}</td></tr>
      {{/wide4}}
      {{#wide5}}
      <tr><td colspan="2">{{wide5}}</td></tr>
      {{/wide5}}
      {{#roll}}
      <tr><td colspan="2"><span class="tcat" data-i18n="diceroll">Dice Roll</span></td></tr>
      <tr><td colspan="2" class="dice_roll_icons">{{roll}}</td></tr>
      {{/roll}}
      {{#results}}
      <tr><td colspan="2"><span class="tcat" data-i18n="results">Results</span></td></tr>
      <tr><td colspan="2" class="dice_roll_icons">{{results}}</td></tr>
      {{/results}}
  </table>
</rolltemplate><!-- Roll Template-Base -->

<rolltemplate class="sheet-rolltemplate-critical">
  <table>
      <tr><th colspan="2">{{title}} {{#subtitle}}<br /><span class="subheader">{{subtitle}}</span>{{/subtitle}}</th></tr>
      {{#flavor}}
      <tr><td colspan="2"><span class="flavor">{{flavor}}</span></td></tr>
      {{/flavor}}
      {{#prewide}}
      <tr><td colspan="2">{{prewide}}</td></tr>
      {{/prewide}}
      {{#header}}
      <tr><td class="tcat-header"><span>{{header}}</span></td><td class="tcat-header"><span>{{item}}</span></td></tr>
      {{/header}}
      {{#allprops() title flavor wide roll results subtitle header item prewide wide2 wide3 wide4 wide5}}
      <tr><td><span class="sheet-tcat">{{key}}</span></td><td>{{value}}</td></tr>
      {{/allprops() title flavor wide roll results subtitle header item prewide wide2 wide3 wide4 wide5}}
      {{#wide}}
      <tr><td colspan="2">{{wide}}</td></tr>
      {{/wide}}
      {{#wide2}}
      <tr><td colspan="2">{{wide2}}</td></tr>
      {{/wide2}}
      {{#wide3}}
      <tr><td colspan="2">{{wide3}}</td></tr>
      {{/wide3}}
      {{#wide4}}
      <tr><td colspan="2">{{wide4}}</td></tr>
      {{/wide4}}
      {{#wide5}}
      <tr><td colspan="2">{{wide5}}</td></tr>
      {{/wide5}}
      {{#roll}}
      <tr><td colspan="2"><span class="tcat" data-i18n="diceroll">Dice Roll</span></td></tr>
      <tr><td colspan="2">{{roll}}</td></tr>
      {{/roll}}
      {{#results}}
      <tr><td colspan="2"><span class="tcat" data-i18n="results">Results</span></td></tr>
      <tr><td colspan="2">{{results}}</td></tr>
      {{/results}}
  </table>
</rolltemplate><!-- Roll Template-Critical -->

<rolltemplate class="sheet-rolltemplate-suggestion">
  <table>
      <tr><th colspan="2">{{title}} {{#subtitle}}<br /><span class="subheader">{{subtitle}}</span>{{/subtitle}}</th></tr>
      {{#flavor}}
      <tr><td colspan="2"><span class="flavor">{{flavor}}</span></td></tr>
      {{/flavor}}
      {{#prewide}}
      <tr><td colspan="2">{{prewide}}</td></tr>
      {{/prewide}}
      {{#header}}
      <tr><td class="tcat-header"><span>{{header}}</span></td><td class="tcat-header"><span>{{item}}</span></td></tr>
      {{/header}}
      {{#allprops() title flavor roll results subtitle header item suggestionsExist success advantage triumph failure threat despair 1advantage1triumph 2advantage1triumph 3advantage1triumph 1triumph 2triumph 1threat1despair 2threat1despair 3threat1despair 1despair 2despair}}
      <tr><td><span class="sheet-tcat">{{key}}</span></td><td>{{value}}</td></tr>
      {{/allprops() title flavor roll results subtitle header item suggestionsExist success advantage triumph failure threat despair 1advantage1triumph 2advantage1triumph 3advantage1triumph 1triumph 2triumph 1threat1despair 2threat1despair 3threat1despair 1despair 2despair}}
      {{#wide}}
      <tr><td colspan="2">{{wide}}</td></tr>
      {{/wide}}
      {{#wide2}}
      <tr><td colspan="2">{{wide2}}</td></tr>
      {{/wide2}}
      {{#wide3}}
      <tr><td colspan="2">{{wide3}}</td></tr>
      {{/wide3}}
      {{#wide4}}
      <tr><td colspan="2">{{wide4}}</td></tr>
      {{/wide4}}
      {{#wide5}}
      <tr><td colspan="2">{{wide5}}</td></tr>
      {{/wide5}}
      {{#roll}}
      <tr><td colspan="2"><span class="tcat" data-i18n="diceroll">Dice Roll</span></td></tr>
      <tr><td colspan="2">{{roll}}</td></tr>
      {{/roll}}
      {{#results}}
      <tr><td colspan="2"><span class="tcat" data-i18n="results">Results</span></td></tr>
      <tr><td colspan="2">{{results}}</td></tr>
      {{/results}}
      {{#suggestionsExist}}
      <tr><td colspan="2"><span class="tcat" data-i18n="spendingsuggestions">Spending Suggestions</span></td></tr>
      {{/suggestionsExist}}
      {{#success}}
      <tr><td><span class="sheet-tcat" data-i18n="success">Success</span></td><td>{{success}}</td></tr>
      {{/success}}
      {{#advantage}}
      <tr><td><span class="sheet-tcat" data-i18n="advantage">Advantage</span></td><td>{{advantage}}</td></tr>
      {{/advantage}}
      {{#triumph}}
      <tr><td><span class="sheet-tcat" data-i18n="triumph">Triumph</span></td><td>{{triumph}}</td></tr>
      {{/triumph}}
      {{#failure}}
      <tr><td><span class="sheet-tcat" data-i18n="failure">Failure</span></td><td>{{failure}}</td></tr>
      {{/failure}}
      {{#threat}}
      <tr><td><span class="sheet-tcat" data-i18n="threat">Threat</span></td><td>{{threat}}</td></tr>
      {{/threat}}
      {{#despair}}
      <tr><td><span class="sheet-tcat" data-i18n="despair">Despair</span></td><td>{{despair}}</td></tr>
      {{/despair}}
      {{#1advantage1triumph}}
      <tr><td><img src="http://i.imgur.com/Gav94H2.png" title="advantage" height="20" width="20"/> or <img src="http://i.imgur.com/1lJCfnB.png" title="triumph" height="20" width="20"/></td><td>{{1advantage1triumph}}</td></tr>
      {{/1advantage1triumph}}
      {{#2advantage1triumph}}
      <tr><td><img src="http://i.imgur.com/Gav94H2.png" title="advantage" height="20" width="20"/><img src="http://i.imgur.com/Gav94H2.png" title="advantage" height="20" width="20"/> or <img src="http://i.imgur.com/1lJCfnB.png" title="triumph" height="20" width="20"/></td><td>{{2advantage1triumph}}</td></tr>
      {{/2advantage1triumph}}
      {{#3advantage1triumph}}
      <tr><td><img src="http://i.imgur.com/Gav94H2.png" title="advantage" height="20" width="20"/><img src="http://i.imgur.com/Gav94H2.png" title="advantage" height="20" width="20"/><img src="http://i.imgur.com/Gav94H2.png" title="advantage" height="20" width="20"/> or <img src="http://i.imgur.com/1lJCfnB.png" title="triumph" height="20" width="20"/></td><td>{{3advantage1triumph}}</td></tr>
      {{/3advantage1triumph}}
      {{#1triumph}}
      <tr><td><img src="http://i.imgur.com/1lJCfnB.png" title="triumph" height="20" width="20"/></td><td>{{1triumph}}</td></tr>
      {{/1triumph}}
      {{#2triumph}}
      <tr><td><img src="http://i.imgur.com/1lJCfnB.png" title="triumph" height="20" width="20"/><img src="http://i.imgur.com/1lJCfnB.png" title="triumph" height="20" width="20"/></td><td>{{2triumph}}</td></tr>
      {{/2triumph}}
      {{#1threat1despair}}
      <tr><td><img src="http://i.imgur.com/o8EQ4z6.png" title="threat" height="20" width="20"/> or <img src="http://i.imgur.com/rOEJlCc.png" title="despair" height="20" width="20"/></td><td>{{1threat1despair}}</td></tr>
      {{/1threat1despair}}
      {{#2threat1despair}}
      <tr><td><img src="http://i.imgur.com/o8EQ4z6.png" title="threat" height="20" width="20"/><img src="http://i.imgur.com/o8EQ4z6.png" title="threat" height="20" width="20"/> or <img src="http://i.imgur.com/rOEJlCc.png" title="despair" height="20" width="20"/></td><td>{{2threat1despair}}</td></tr>
      {{/2threat1despair}}
      {{#3threat1despair}}
      <tr><td><img src="http://i.imgur.com/o8EQ4z6.png" title="threat" height="20" width="20"/><img src="http://i.imgur.com/o8EQ4z6.png" title="threat" height="20" width="20"/><img src="http://i.imgur.com/o8EQ4z6.png" title="threat" height="20" width="20"/> or <img src="http://i.imgur.com/rOEJlCc.png" title="despair" height="20" width="20"/></td><td>{{3threat1despair}}</td></tr>
      {{/3threat1despair}}
      {{#1despair}}
      <tr><td><img src="http://i.imgur.com/rOEJlCc.png" title="despair" height="20" width="20"/></td><td>{{1despair}}</td></tr>
      {{/1despair}}
      {{#2despair}}
      <tr><td><img src="http://i.imgur.com/rOEJlCc.png" title="despair" height="20" width="20"/><img src="http://i.imgur.com/rOEJlCc.png" title="despair" height="20" width="20"/></td><td>{{2despair}}</td></tr>
      {{/2despair}}
  </table>
</rolltemplate><!-- Roll Template-Suggestions -->


<!-- Sheet Workers -->
<script type="text/worker">

  /* Worker for section tabs */
  const buttonlist = ['skills','combat','equipment','talents','force','settings'];
  buttonlist.forEach(button => {
    on(`clicked:${button}`, function() {
      setAttrs({
        sheetTab: button,
        navSelection: button
      });
    });
  });
  
  /* Workers for skill dice */
  const skillStat = {
    "astrogation":"intellect",
    "athletics":"brawn",
    "charm":"presence",
    "coercion":"willpower",
    "computers":"intellect",
    "cool":"presence",
    "coordination":"agility",
    "deception":"cunning",
    "discipline":"willpower",
    "leadership":"presence",
    "mechanics":"intellect",
    "medicine":"intellect",
    "negotiation":"presence",
    "perception":"cunning",
    "piloting-planetary":"agility",
    "piloting-space":"agility",
    "resilience":"brawn",
    "skullduggery":"cunning",
    "stealth":"agility",
    "streetwise":"cunning",
    "survival":"cunning",
    "vigilance":"willpower",
    "brawl":"brawn",
    "melee":"brawn",
    "gunnery":"agility",
    "lightsaber":"brawn",
    "ranged-light":"agility",
    "ranged-heavy":"agility",
    "core-worlds":"intellect",
    "education":"intellect",
    "lore":"intellect",
    "outer-rim":"intellect",
    "underworld":"intellect",
    "xenology":"intellect"
  };
  
  // When the skill rank changes, update the dice
  const CalculateDice = function(eventInfo) {
    const skill = (eventInfo.sourceAttribute).slice(0,-5);
    const stat = skillStat[skill];
    let rank = 0;
    let yellowDice = 0;
    let greenDice = 0;
    let yellowDiceName = '';
    let greenDiceName = '';
    let statValue = 0;
    rank = parseInt(eventInfo.newValue);
    getAttrs([stat, 'lightsaber_characteristic_value'], function(values){
      statValue = (skill === 'lightsaber') ? parseInt(values.lightsaber_characteristic_value) : parseInt(values[stat]);  
      yellowDice = parseInt((statValue + rank) - Math.abs(statValue - rank))/2;
      greenDice = parseInt((((statValue + rank) + Math.abs(statValue - rank)) / 2) - yellowDice);
      yellowDiceName = skill + '_yd';
      greenDiceName = skill + '_gd';
      setAttrs({[yellowDiceName]: yellowDice, [greenDiceName]: greenDice});
    });
  };
  
  for (const skill in skillStat) {
    // Worker for calculating skill dice
    var skillRank = skill + '_rank';
    on('change:' + skillRank, function(eventInfo) {
      CalculateDice(eventInfo);
    });
  }
  
  // When the associated attribute changes, update the dice
  const CalculateDiceStatChange = function(eventInfo,skill) {
    //const stat = skillStat[skill];
    const statValue = parseInt(eventInfo.newValue);
    let rank = 0;
    let yellowDice = 0;
    let greenDice = 0;
    let yellowDiceName = '';
    let greenDiceName = '';
    const rankAttr = skill+'_rank';
    getAttrs([rankAttr], function(values){
      rank = parseInt(values[rankAttr]);
      yellowDice = parseInt((statValue + rank) - Math.abs(statValue - rank))/2;
      greenDice = parseInt((((statValue + rank) + Math.abs(statValue - rank)) / 2) - yellowDice);
      yellowDiceName = skill + '_yd';
      greenDiceName = skill + '_gd';
      setAttrs({[yellowDiceName]: yellowDice, [greenDiceName]: greenDice});
    });  
  };
  
  for (const skill in skillStat) {
    on('change:brawn change:agility change:intellect change:cunning change:willpower change:presence', function(eventInfo) {
      if (skillStat[skill] === eventInfo.sourceAttribute) {
        CalculateDiceStatChange(eventInfo,skill);
      }
    });  
  };
  
  // When the Lightsaber skill changes, update the lightsaber dice
  on('change:lightsaber_characteristic', function(eventInfo) {
    const statAt = eventInfo.newValue;
    const statAtLength = statAt.length;  
    const stat = statAt.slice(2,statAtLength-1);
    getAttrs(['lightsaber_rank',stat], function(values){
      rank = parseInt(values.lightsaber_rank);
      statValue = parseInt(values[stat]);
      yellowDice = parseInt((statValue + rank) - Math.abs(statValue - rank))/2;
      greenDice = parseInt((((statValue + rank) + Math.abs(statValue - rank)) / 2) - yellowDice);
      setAttrs({lightsaber_yd: yellowDice, lightsaber_gd: greenDice, lightsaber_characteristic_value: statValue});
    });
  });
  
  /* Workers for calculating weapon quality dice */
  
  // Cumbersome
  on('change:repeating_weapons:weapon_quality_cumbersome_value', function(eventInfo) {
    var cumbersome = parseInt(eventInfo.newValue);
    getAttrs(['brawn'], function(values) {
      var brawn = parseInt(values.brawn);
      var penalty = cumbersome - brawn;    
      if (penalty > 0) {
        setAttrs({'repeating_weapons_weapon_quality_cumbersome_penalty':penalty});
      }
      else {
        setAttrs({'repeating_weapons_weapon_quality_cumbersome_penalty':0});
      }
    });
  });
  
  // Defensive
  on('change:repeating_weapons:weapon_quality_defensive_value', function(eventInfo) {
    var defensive = parseInt(eventInfo.newValue);
    setAttrs({'body_stats_defense_melee':defensive});
  });
  
  // Deflection
  on('change:repeating_weapons:weapon_quality_deflection_value', function(eventInfo) {
    var deflection = parseInt(eventInfo.newValue);
    setAttrs({'body_stats_defense_ranged':deflection});
  });
  
  // Inferior
  on('change:repeating_weapons:weapon_quality_inferior_value', function(eventInfo) {
    var inferior = eventInfo.newValue;
    if (inferior === 'Yes') {
      getAttrs(['repeating_weapons_weapon_damage_bonus'], function(values) {
        var damageBonus = parseInt(values.repeating_weapons_weapon_damage_bonus);
        setAttrs({'repeating_weapons_weapon_damage_bonus':damageBonus-1});
      });
    }
    else {
      getAttrs(['repeating_weapons_weapon_damage_bonus'], function(values) {
        var damageBonus = parseInt(values.repeating_weapons_weapon_damage_bonus);
        setAttrs({'repeating_weapons_weapon_damage_bonus':damageBonus+1});
      });
    }
  });
  
  
  /* Display wapon qualities in the roll template */
  
  var qualitiesObject = {
    'weapon_quality_accurate_value':'Accurate',
    'weapon_quality_auto_fire_value':'Auto-Fire',
    'weapon_quality_blast_value':'Blast',
    'weapon_quality_breach_value':'Breach',
    'weapon_quality_burn_value':'Burn',
    'weapon_quality_concussive_value':'Concussive',
    'weapon_quality_cortosis_value':'Cortosis',
    'weapon_quality_cumbersome_value':'Cumbersome',
    'weapon_quality_defensive_value':'Defensive',
    'weapon_quality_deflection_value':'Deflection',
    'weapon_quality_disorient_value':'Disorient',
    'weapon_quality_ensnare_value':'Ensnare',
    'weapon_quality_guided_value':'Guided',  
    'weapon_quality_knockdown_value':'Knockdown',
    'weapon_quality_inaccurate_value':'Inaccurate',
    'weapon_quality_inferior_value':'Inferior',
    'weapon_quality_ion_value':'Ion',
    'weapon_quality_limited_ammo_value':'Limited Ammo',
    'weapon_quality_linked_value':'Linked',
    'weapon_quality_pierce_value':'Pierce',
    'weapon_quality_prepare_value':'Prepare',
    'weapon_quality_slow_firing_value':'Slow-Firing',
    'weapon_quality_stun_damage_value':'Stun Damage',
    'weapon_quality_sunder_value':'Sunder',
    'weapon_quality_superior_value':'Superior',
    'weapon_quality_vicious_value':'Vicious'
  };
  
  let weaponQualities = [];
  
  // Update the quality list for display in the roll template based on adding/removing/updating weapon qualities
  for (const quality in qualitiesObject) {
    const qualityTitle = qualitiesObject[quality];
    let qualityList = '';
    on('change:repeating_weapons:' + quality, function(eventInfo) {
      const qualityValue = eventInfo.newValue;
      const inArray = weaponQualities.findIndex(thisQuality => thisQuality.includes(qualityTitle));
      if (inArray === -1){
        switch(qualityValue) {
          case 'Yes':
            weaponQualities.push(qualityTitle);
            break;
          case 'No':
            // Do nothing
            break;
          default:
            weaponQualities.push(qualityTitle + ' ' + qualityValue);
        }
      }
      else {
        switch(qualityValue) {
          case 'Yes':
            // Do nothing
            break;
          case 'No':
            let removed = weaponQualities.splice(inArray, 1);
            break;
          default:
            if (parseInt(qualityValue) > 0){
              let removed = weaponQualities.splice(inArray, 1, qualityTitle + ' ' + qualityValue);
            }
            else {
              let removed = weaponQualities.splice(inArray, 1);
            }
        }
      }
      qualityList = weaponQualities.join(', ');
      setAttrs({'repeating_weapons_weapon_qualities_list':qualityList}); 
    })
  };
  
  // Send weapon skill type dice to the roller based on weapon skill select box
  on('change:repeating_weapons:weapon_skill', function(eventInfo) {
    const skill = eventInfo.newValue;
    let diceCalc = '';
    switch (skill){
      case 'Brawl':
        diceCalc = 'skill(@{brawl_rank}|@{brawn}|@{brawl_modifiers})';
        break;
      case 'Melee':
        diceCalc = 'skill(@{melee_rank}|@{brawn}|@{melee_modifiers})';
        break;
      case 'Gunnery':
        diceCalc = 'skill(@{gunnery_rank}|@{agility}|@{gunnery_modifiers})';
        break;
      case 'Ranged - Light':
        diceCalc = 'skill(@{ranged-light_rank}|@{agility}|@{ranged-light_modifiers})';
        break;
      case 'Ranged - Heavy':
        diceCalc = 'skill(@{ranged-heavy_rank}|@{agility}|@{ranged-heavy_modifiers})';
        break;
      case 'Lightsaber':
        diceCalc = 'skill(@{lightsaber_rank}|@{lightsaber_characteristic}|@{lightsaber_modifiers})';
        break;
      case 'Mechanics':
        diceCalc = 'skill(@{mechanics_rank}|@{intellect})';
        break;
      case 'Medicine':
        diceCalc = 'skill(@{medicine_rank}|@{intellect})';
        break;
      case 'Resilience':
        diceCalc = 'skill(@{resilience_rank}|@{brawn})';
        break;
    };
    setAttrs({repeating_weapons_weapon_skill_value:diceCalc});
  });
  
</script>
<!-- End Sheet Workers -->

